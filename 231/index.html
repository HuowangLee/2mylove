<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç”œèœœè´ªåƒè›‡ â¤ï¸ æ‹çˆ±231å¤©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Arial', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #ffeef8 0%, #ffe4f3 50%, #ffd4ec 100%);
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
            touch-action: none;
        }

        /* çˆ±å¿ƒèƒŒæ™¯è£…é¥° */
        .hearts-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .heart-float {
            position: absolute;
            font-size: 20px;
            opacity: 0.15;
            animation: float 15s infinite;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.15;
            }
            90% {
                opacity: 0.15;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        #gameContainer {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            height: 100vh;
            padding: 20px 10px;
            z-index: 1;
        }

        #topBar {
            width: 100%;
            max-width: 400px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 25px;
            box-shadow: 0 4px 15px rgba(255, 105, 180, 0.3);
        }

        .score-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .score-label {
            font-size: 12px;
            color: #ff69b4;
            font-weight: bold;
        }

        .score-value {
            font-size: 20px;
            color: #ff1493;
            font-weight: bold;
        }

        #gameCanvas {
            border: 4px solid #ff69b4;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 8px 30px rgba(255, 105, 180, 0.4);
            max-width: 400px;
            width: 100%;
            aspect-ratio: 1;
        }

        /* è™šæ‹Ÿæ‘‡æ† */
        #joystickContainer {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 150px;
            z-index: 10;
        }

        #joystickBase {
            position: absolute;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: rgba(255, 182, 193, 0.4);
            border: 3px solid #ff69b4;
            box-shadow: 0 4px 15px rgba(255, 105, 180, 0.3);
        }

        #joystickStick {
            position: absolute;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            border: 3px solid #ffffff;
            box-shadow: 0 4px 10px rgba(255, 20, 147, 0.5);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        /* å¼€å§‹/é‡æ–°å¼€å§‹æŒ‰é’® */
        #startButton {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px 50px;
            font-size: 24px;
            font-weight: bold;
            color: white;
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            border: none;
            border-radius: 50px;
            box-shadow: 0 8px 20px rgba(255, 105, 180, 0.5);
            cursor: pointer;
            z-index: 100;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: translate(-50%, -50%) scale(1);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.05);
            }
        }

        /* æ¸¸æˆç»“æŸå’Œé€šå…³å¼¹çª— */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 200;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #fff0f6, #ffe4f1);
            padding: 40px 30px;
            border-radius: 30px;
            text-align: center;
            max-width: 90%;
            box-shadow: 0 10px 40px rgba(255, 105, 180, 0.6);
            animation: modalPop 0.5s;
        }

        @keyframes modalPop {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .modal-title {
            font-size: 32px;
            color: #ff1493;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .modal-text {
            font-size: 18px;
            color: #ff69b4;
            margin: 10px 0;
        }

        .modal-love {
            font-size: 48px;
            margin: 20px 0;
            animation: heartBeat 1s infinite;
        }

        @keyframes heartBeat {
            0%, 100% {
                transform: scale(1);
            }
            25% {
                transform: scale(1.2);
            }
            50% {
                transform: scale(1);
            }
        }

        .modal-button {
            margin-top: 20px;
            padding: 15px 40px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 105, 180, 0.5);
        }

        .modal-button:active {
            transform: scale(0.95);
        }

        /* ç‰¹æ®Šæ–‡å­—æ•ˆæœ */
        .special-text {
            font-size: 24px;
            color: #ff1493;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(255, 105, 180, 0.5);
        }
    </style>
</head>
<body>
    <!-- çˆ±å¿ƒèƒŒæ™¯ -->
    <div class="hearts-bg" id="heartsBg"></div>

    <!-- æ¸¸æˆå®¹å™¨ -->
    <div id="gameContainer">
        <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
        <div id="topBar">
            <div class="score-item">
                <span class="score-label">åˆ†æ•° ğŸ’•</span>
                <span class="score-value" id="score">0</span>
            </div>
            <div class="score-item">
                <span class="score-label">æœ€é«˜åˆ† â­</span>
                <span class="score-value" id="highScore">0</span>
            </div>
        </div>

        <!-- æ¸¸æˆç”»å¸ƒ -->
        <canvas id="gameCanvas"></canvas>

        <!-- è™šæ‹Ÿæ‘‡æ† -->
        <div id="joystickContainer">
            <div id="joystickBase"></div>
            <div id="joystickStick">â¤ï¸</div>
        </div>
    </div>

    <!-- å¼€å§‹æŒ‰é’® -->
    <button id="startButton">å¼€å§‹æ¸¸æˆ â¤ï¸</button>

    <!-- æ¸¸æˆç»“æŸå¼¹çª— -->
    <div id="gameOverModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">æ¸¸æˆç»“æŸ ğŸ’”</div>
            <div class="modal-text">å¾—åˆ†ï¼š<span id="finalScore" class="special-text">0</span></div>
            <div class="modal-love">ğŸ˜¢</div>
            <button class="modal-button" onclick="restartGame()">å†æ¥ä¸€æ¬¡ ğŸ’–</button>
        </div>
    </div>

    <!-- é€šå…³å¼¹çª— -->
    <div id="winModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">æ­å–œé€šå…³ï¼ğŸ‰</div>
            <div class="modal-love">â¤ï¸ğŸ’•ğŸ’–</div>
            <div class="special-text" style="font-size: 28px; margin: 20px 0;">
                ğŸŠ æ‹çˆ±ç¬¬ 231 å¤© ğŸŠ
            </div>
            <div class="modal-text" style="font-size: 20px;">
                æ„¿æˆ‘ä»¬çš„çˆ±æƒ…<br>
                åƒè¿™è´ªåƒè›‡ä¸€æ ·<br>
                è¶Šæ¥è¶Šé•¿ï¼Œæ°¸ä¸ç»“æŸ ğŸ’
            </div>
            <div class="modal-love">ğŸ’‘</div>
            <button class="modal-button" onclick="restartGame()">å†ç©ä¸€æ¬¡ ğŸ’•</button>
        </div>
    </div>

    <script>
        // æ¸¸æˆé…ç½®
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // è®¾ç½®ç”»å¸ƒå¤§å°
        function resizeCanvas() {
            const container = document.getElementById('gameContainer');
            const topBar = document.getElementById('topBar');
            const maxSize = Math.min(window.innerWidth - 20, window.innerHeight - topBar.offsetHeight - 200);
            canvas.width = maxSize;
            canvas.height = maxSize;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // æ¸¸æˆå˜é‡
        const gridSize = 20;
        let tileCount;
        let snake;
        let food;
        let dx = 0;
        let dy = 0;
        let score = 0;
        let highScore = localStorage.getItem('snakeHighScore') || 0;
        let gameRunning = false;
        let gameLoop;
        const winScore = 23; // é€šå…³åˆ†æ•°è®¾ç½®ä¸º23ï¼ˆä»£è¡¨231ï¼‰

        document.getElementById('highScore').textContent = highScore;

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            tileCount = Math.floor(canvas.width / gridSize);
            snake = [
                { x: Math.floor(tileCount / 2), y: Math.floor(tileCount / 2) }
            ];
            dx = 0;
            dy = 0;
            score = 0;
            document.getElementById('score').textContent = score;
            placeFood();
        }

        // æ”¾ç½®é£Ÿç‰©
        function placeFood() {
            do {
                food = {
                    x: Math.floor(Math.random() * tileCount),
                    y: Math.floor(Math.random() * tileCount)
                };
            } while (snake.some(segment => segment.x === food.x && segment.y === food.y));
        }

        // ç»˜åˆ¶æ¸¸æˆ
        function drawGame() {
            // æ¸…ç©ºç”»å¸ƒ
            ctx.fillStyle = '#fff9fc';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ç»˜åˆ¶ç½‘æ ¼
            ctx.strokeStyle = '#ffe4f1';
            ctx.lineWidth = 1;
            for (let i = 0; i <= tileCount; i++) {
                ctx.beginPath();
                ctx.moveTo(i * gridSize, 0);
                ctx.lineTo(i * gridSize, canvas.height);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(0, i * gridSize);
                ctx.lineTo(canvas.width, i * gridSize);
                ctx.stroke();
            }

            // ç»˜åˆ¶è›‡
            snake.forEach((segment, index) => {
                if (index === 0) {
                    // è›‡å¤´
                    const gradient = ctx.createLinearGradient(
                        segment.x * gridSize, segment.y * gridSize,
                        (segment.x + 1) * gridSize, (segment.y + 1) * gridSize
                    );
                    gradient.addColorStop(0, '#ff69b4');
                    gradient.addColorStop(1, '#ff1493');
                    ctx.fillStyle = gradient;
                } else {
                    // è›‡èº«
                    const gradient = ctx.createLinearGradient(
                        segment.x * gridSize, segment.y * gridSize,
                        (segment.x + 1) * gridSize, (segment.y + 1) * gridSize
                    );
                    gradient.addColorStop(0, '#ffb6c1');
                    gradient.addColorStop(1, '#ff69b4');
                    ctx.fillStyle = gradient;
                }
                
                ctx.fillRect(
                    segment.x * gridSize + 2,
                    segment.y * gridSize + 2,
                    gridSize - 4,
                    gridSize - 4
                );
                
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                ctx.strokeRect(
                    segment.x * gridSize + 2,
                    segment.y * gridSize + 2,
                    gridSize - 4,
                    gridSize - 4
                );

                // è›‡å¤´åŠ çœ¼ç›
                if (index === 0) {
                    ctx.fillStyle = '#ffffff';
                    const eyeSize = 3;
                    const eyeOffset = 5;
                    if (dx !== 0 || dy === 0) {
                        ctx.fillRect(segment.x * gridSize + eyeOffset, segment.y * gridSize + eyeOffset, eyeSize, eyeSize);
                        ctx.fillRect(segment.x * gridSize + gridSize - eyeOffset - eyeSize, segment.y * gridSize + eyeOffset, eyeSize, eyeSize);
                    }
                }
            });

            // ç»˜åˆ¶é£Ÿç‰©ï¼ˆçˆ±å¿ƒï¼‰
            ctx.fillStyle = '#ff1493';
            ctx.font = `${gridSize - 4}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('ğŸ’–', food.x * gridSize + gridSize / 2, food.y * gridSize + gridSize / 2);
        }

        // æ›´æ–°æ¸¸æˆ
        function updateGame() {
            if (!gameRunning) return;

            // ç§»åŠ¨è›‡
            const head = { x: snake[0].x + dx, y: snake[0].y + dy };

            // æ£€æŸ¥ç¢°æ’å¢™å£
            if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount) {
                gameOver();
                return;
            }

            // æ£€æŸ¥ç¢°æ’è‡ªå·±
            if (snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                gameOver();
                return;
            }

            snake.unshift(head);

            // æ£€æŸ¥æ˜¯å¦åƒåˆ°é£Ÿç‰©
            if (head.x === food.x && head.y === food.y) {
                score++;
                document.getElementById('score').textContent = score;
                
                if (score > highScore) {
                    highScore = score;
                    localStorage.setItem('snakeHighScore', highScore);
                    document.getElementById('highScore').textContent = highScore;
                }

                // æ£€æŸ¥æ˜¯å¦é€šå…³
                if (score >= winScore) {
                    winGame();
                    return;
                }

                placeFood();
                createHeartEffect(food.x * gridSize, food.y * gridSize);
            } else {
                snake.pop();
            }

            drawGame();
        }

        // æ¸¸æˆç»“æŸ
        function gameOver() {
            gameRunning = false;
            clearInterval(gameLoop);
            document.getElementById('finalScore').textContent = score;
            document.getElementById('gameOverModal').style.display = 'flex';
        }

        // é€šå…³
        function winGame() {
            gameRunning = false;
            clearInterval(gameLoop);
            document.getElementById('winModal').style.display = 'flex';
            createFireworks();
        }

        // é‡æ–°å¼€å§‹
        function restartGame() {
            document.getElementById('gameOverModal').style.display = 'none';
            document.getElementById('winModal').style.display = 'none';
            document.getElementById('startButton').style.display = 'block';
            initGame();
            drawGame();
        }

        // å¼€å§‹æ¸¸æˆ
        document.getElementById('startButton').addEventListener('click', function() {
            this.style.display = 'none';
            gameRunning = true;
            dx = 1;
            dy = 0;
            gameLoop = setInterval(updateGame, 250);
        });

        // è™šæ‹Ÿæ‘‡æ†æ§åˆ¶
        const joystickContainer = document.getElementById('joystickContainer');
        const joystickStick = document.getElementById('joystickStick');
        let joystickActive = false;
        let joystickStartPos = { x: 0, y: 0 };

        function handleJoystickStart(e) {
            joystickActive = true;
            const touch = e.touches ? e.touches[0] : e;
            const rect = joystickContainer.getBoundingClientRect();
            joystickStartPos = {
                x: touch.clientX - rect.left - 75,
                y: touch.clientY - rect.top - 75
            };
        }

        function handleJoystickMove(e) {
            if (!joystickActive || !gameRunning) return;
            e.preventDefault();
            
            const touch = e.touches ? e.touches[0] : e;
            const rect = joystickContainer.getBoundingClientRect();
            const deltaX = touch.clientX - rect.left - 75;
            const deltaY = touch.clientY - rect.top - 75;
            
            const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            const maxDistance = 40;
            
            let finalX = deltaX;
            let finalY = deltaY;
            
            if (distance > maxDistance) {
                finalX = (deltaX / distance) * maxDistance;
                finalY = (deltaY / distance) * maxDistance;
            }
            
            joystickStick.style.transform = `translate(${finalX}px, ${finalY}px)`;
            
            // ç¡®å®šæ–¹å‘
            const angle = Math.atan2(deltaY, deltaX);
            const direction = Math.round(angle / (Math.PI / 2));
            
            let newDx = dx;
            let newDy = dy;
            
            if (Math.abs(deltaX) > Math.abs(deltaY)) {
                if (deltaX > 15) {
                    newDx = 1;
                    newDy = 0;
                } else if (deltaX < -15) {
                    newDx = -1;
                    newDy = 0;
                }
            } else {
                if (deltaY > 15) {
                    newDx = 0;
                    newDy = 1;
                } else if (deltaY < -15) {
                    newDx = 0;
                    newDy = -1;
                }
            }
            
            // é˜²æ­¢åå‘
            if (!(newDx === -dx && dx !== 0) && !(newDy === -dy && dy !== 0)) {
                dx = newDx;
                dy = newDy;
            }
        }

        function handleJoystickEnd() {
            joystickActive = false;
            joystickStick.style.transform = 'translate(0, 0)';
        }

        joystickContainer.addEventListener('touchstart', handleJoystickStart);
        joystickContainer.addEventListener('touchmove', handleJoystickMove);
        joystickContainer.addEventListener('touchend', handleJoystickEnd);
        joystickContainer.addEventListener('mousedown', handleJoystickStart);
        document.addEventListener('mousemove', handleJoystickMove);
        document.addEventListener('mouseup', handleJoystickEnd);

        // é”®ç›˜æ§åˆ¶ï¼ˆå¤‡ç”¨ï¼‰
        document.addEventListener('keydown', (e) => {
            if (!gameRunning) return;
            
            let newDx = dx;
            let newDy = dy;
            
            switch(e.key) {
                case 'ArrowUp':
                    newDx = 0;
                    newDy = -1;
                    break;
                case 'ArrowDown':
                    newDx = 0;
                    newDy = 1;
                    break;
                case 'ArrowLeft':
                    newDx = -1;
                    newDy = 0;
                    break;
                case 'ArrowRight':
                    newDx = 1;
                    newDy = 0;
                    break;
                default:
                    return;
            }
            
            // é˜²æ­¢åå‘
            if (!(newDx === -dx && dx !== 0) && !(newDy === -dy && dy !== 0)) {
                dx = newDx;
                dy = newDy;
            }
        });

        // åˆ›å»ºçˆ±å¿ƒç‰¹æ•ˆ
        function createHeartEffect(x, y) {
            const heart = document.createElement('div');
            heart.textContent = 'ğŸ’•';
            heart.style.position = 'fixed';
            heart.style.left = x + 'px';
            heart.style.top = y + 'px';
            heart.style.fontSize = '30px';
            heart.style.pointerEvents = 'none';
            heart.style.zIndex = '1000';
            heart.style.animation = 'floatUp 1s ease-out';
            document.body.appendChild(heart);
            
            setTimeout(() => heart.remove(), 1000);
        }

        // åˆ›å»ºçƒŸèŠ±æ•ˆæœ
        function createFireworks() {
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const heart = document.createElement('div');
                    heart.textContent = ['â¤ï¸', 'ğŸ’•', 'ğŸ’–', 'ğŸ’—', 'ğŸ’'][Math.floor(Math.random() * 5)];
                    heart.style.position = 'fixed';
                    heart.style.left = Math.random() * window.innerWidth + 'px';
                    heart.style.top = Math.random() * window.innerHeight + 'px';
                    heart.style.fontSize = '40px';
                    heart.style.pointerEvents = 'none';
                    heart.style.zIndex = '1000';
                    heart.style.animation = 'floatUp 2s ease-out';
                    document.body.appendChild(heart);
                    
                    setTimeout(() => heart.remove(), 2000);
                }, i * 100);
            }
        }

        // æ·»åŠ æµ®åŠ¨åŠ¨ç”»
        const style = document.createElement('style');
        style.textContent = `
            @keyframes floatUp {
                0% {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
                100% {
                    opacity: 0;
                    transform: translateY(-100px) scale(1.5);
                }
            }
        `;
        document.head.appendChild(style);

        // åˆå§‹åŒ–èƒŒæ™¯çˆ±å¿ƒ
        const heartsBg = document.getElementById('heartsBg');
        for (let i = 0; i < 15; i++) {
            const heart = document.createElement('div');
            heart.className = 'heart-float';
            heart.textContent = 'â¤ï¸';
            heart.style.left = Math.random() * 100 + '%';
            heart.style.animationDelay = Math.random() * 15 + 's';
            heart.style.animationDuration = (10 + Math.random() * 10) + 's';
            heartsBg.appendChild(heart);
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        initGame();
        drawGame();
    </script>
</body>
</html>
