<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ğŸ’• çˆ±çš„è¿å‡» - æ‹çˆ±255å¤©çºªå¿µ ğŸ’•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            touch-action: none;
            user-select: none;
        }

        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        /* å¼€å§‹ç•Œé¢ */
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            transition: opacity 0.5s;
        }

        #start-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .title {
            font-size: 3rem;
            color: white;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
            margin-bottom: 1rem;
            animation: pulse 2s infinite;
        }

        .subtitle {
            font-size: 1.5rem;
            color: rgba(255,255,255,0.9);
            margin-bottom: 0.5rem;
        }

        .love-days {
            font-size: 2.5rem;
            color: #fff;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 2rem;
            animation: glow 2s infinite;
        }

        .start-btn {
            padding: 1.5rem 3rem;
            font-size: 1.5rem;
            background: white;
            color: #f5576c;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
            transition: transform 0.3s;
            font-weight: bold;
        }

        .start-btn:active {
            transform: scale(0.95);
        }

        .instructions {
            margin-top: 2rem;
            color: white;
            font-size: 1.1rem;
            text-align: center;
            max-width: 90%;
        }

        /* æ¸¸æˆç•Œé¢ */
        #game-screen {
            width: 100%;
            height: 100%;
            position: relative;
        }

        #hud {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
            background: linear-gradient(to bottom, rgba(0,0,0,0.3), transparent);
        }

        .hud-item {
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        #combo {
            font-size: 2rem;
            color: #ffeb3b;
        }

        /* æ–¹å‘æŒ‡ä»¤æ˜¾ç¤º */
        #direction-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10rem;
            color: white;
            text-shadow: 0 0 30px rgba(255,255,255,0.8);
            animation: fadeInScale 0.3s;
            pointer-events: none;
            z-index: 5;
        }

        /* åˆ’ç—•è½¨è¿¹ */
        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* ç²’å­å®¹å™¨ */
        #particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 3;
        }

        .particle {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            pointer-events: none;
        }

        /* åé¦ˆæ–‡å­— */
        .feedback {
            position: absolute;
            font-size: 3rem;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 20px currentColor;
            pointer-events: none;
            z-index: 20;
            animation: feedbackFloat 1s forwards;
        }

        .feedback.success {
            color: #4caf50;
        }

        .feedback.perfect {
            color: #ffeb3b;
        }

        .feedback.fail {
            color: #f44336;
        }

        /* æ¸¸æˆç»“æŸç•Œé¢ */
        #game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }

        #game-over.show {
            display: flex;
            animation: fadeIn 0.5s;
        }

        .game-over-title {
            font-size: 2.5rem;
            color: white;
            margin-bottom: 1rem;
        }

        .final-score {
            font-size: 3rem;
            color: #fff;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .high-score {
            font-size: 1.5rem;
            color: rgba(255,255,255,0.9);
            margin-bottom: 2rem;
        }

        .love-message {
            font-size: 1.3rem;
            color: white;
            text-align: center;
            max-width: 80%;
            margin-bottom: 2rem;
            line-height: 1.8;
        }

        .restart-btn {
            padding: 1.2rem 2.5rem;
            font-size: 1.3rem;
            background: white;
            color: #f5576c;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
            transition: transform 0.3s;
            font-weight: bold;
        }

        .restart-btn:active {
            transform: scale(0.95);
        }

        /* åŠ¨ç”» */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes glow {
            0%, 100% { text-shadow: 0 0 20px rgba(255,255,255,0.5); }
            50% { text-shadow: 0 0 30px rgba(255,255,255,0.8), 0 0 40px rgba(255,255,255,0.6); }
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        @keyframes feedbackFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(1.5);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* å¿ƒå½¢é£˜è½ */
        .heart {
            position: absolute;
            color: rgba(255,255,255,0.7);
            font-size: 2rem;
            pointer-events: none;
            animation: heartFall 3s linear;
            z-index: 2;
        }

        @keyframes heartFall {
            0% {
                transform: translateY(-50px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* å€’è®¡æ—¶ */
        #countdown {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 15rem;
            color: white;
            text-shadow: 0 0 50px rgba(255,255,255,0.8);
            z-index: 30;
            font-weight: bold;
            animation: countdownPulse 1s;
        }

        @keyframes countdownPulse {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        @media (max-width: 768px) {
            .title { font-size: 2rem; }
            .subtitle { font-size: 1.2rem; }
            .love-days { font-size: 2rem; }
            .start-btn { padding: 1rem 2rem; font-size: 1.2rem; }
            .instructions { font-size: 1rem; }
            #direction-display { font-size: 8rem; }
            .feedback { font-size: 2rem; }
            #countdown { font-size: 10rem; }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- å¼€å§‹ç•Œé¢ -->
        <div id="start-screen">
            <div class="title">ğŸ’• çˆ±çš„è¿å‡» ğŸ’•</div>
            <div class="subtitle">Love Slash Combo</div>
            <div class="love-days">æ‹çˆ±ç¬¬ 255 å¤©</div>
            <button class="start-btn" id="start-btn">å¼€å§‹æ¸¸æˆ</button>
            <div class="instructions">
                ğŸ“± æ ¹æ®å±å¹•æç¤ºçš„æ–¹å‘æ»‘åŠ¨<br>
                ğŸ’– è¿ç»­æˆåŠŸå¢åŠ è¿å‡»æ•°<br>
                âš¡ å¤±è´¥ä¸€æ¬¡æ¸¸æˆç»“æŸ
            </div>
        </div>

        <!-- æ¸¸æˆç•Œé¢ -->
        <div id="game-screen">
            <div id="hud">
                <div class="hud-item">åˆ†æ•°: <span id="score">0</span></div>
                <div class="hud-item" id="combo">è¿å‡»: <span id="combo-count">0</span></div>
            </div>
            <canvas id="canvas"></canvas>
            <div id="direction-display"></div>
            <div id="particles"></div>
        </div>

        <!-- æ¸¸æˆç»“æŸç•Œé¢ -->
        <div id="game-over">
            <div class="game-over-title">ğŸ’– æ¸¸æˆç»“æŸ ğŸ’–</div>
            <div class="final-score">åˆ†æ•°: <span id="final-score">0</span></div>
            <div class="high-score">æœ€é«˜åˆ†: <span id="high-score">0</span></div>
            <div class="love-message">
                å°±åƒæˆ‘ä»¬çš„çˆ±æƒ…ä¸€æ ·ï¼Œ<br>
                æ¯ä¸€æ¬¡çš„ç›¸é‡éƒ½æ˜¯å®Œç¾çš„è¿å‡»ï¼<br>
                255å¤©çš„ç”œèœœï¼Œæœªæ¥è¿˜æœ‰æ— æ•°ä¸ª255å¤© â¤ï¸
            </div>
            <button class="restart-btn" id="restart-btn">å†æ¥ä¸€æ¬¡</button>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        const game = {
            score: 0,
            combo: 0,
            maxCombo: 0,
            currentDirection: null,
            isPlaying: false,
            highScore: localStorage.getItem('slashComboHighScore') || 0,
            directions: [
                { name: 'â†—', angle: 45, symbol: 'â†—' },
                { name: 'â†’', angle: 90, symbol: 'â†’' },
                { name: 'â†˜', angle: 135, symbol: 'â†˜' },
                { name: 'â†“', angle: 180, symbol: 'â†“' },
                { name: 'â†™', angle: 225, symbol: 'â†™' },
                { name: 'â†', angle: 270, symbol: 'â†' },
                { name: 'â†–', angle: 315, symbol: 'â†–' },
                { name: 'â†‘', angle: 0, symbol: 'â†‘' }
            ]
        };

        // DOM å…ƒç´ 
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const gameOver = document.getElementById('game-over');
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');
        const scoreEl = document.getElementById('score');
        const comboCountEl = document.getElementById('combo-count');
        const directionDisplay = document.getElementById('direction-display');
        const finalScoreEl = document.getElementById('final-score');
        const highScoreEl = document.getElementById('high-score');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const particlesContainer = document.getElementById('particles');

        // è®¾ç½® canvas å°ºå¯¸
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // è§¦æ‘¸/é¼ æ ‡ä½ç½®
        let touchStart = null;

        // å¼€å§‹æ¸¸æˆ
        startBtn.addEventListener('click', startGame);
        restartBtn.addEventListener('click', () => {
            gameOver.classList.remove('show');
            startGame();
        });

        function startGame() {
            startScreen.classList.add('hidden');
            game.score = 0;
            game.combo = 0;
            game.maxCombo = 0;
            game.isPlaying = false;
            updateHUD();
            
            // å€’è®¡æ—¶
            showCountdown(3, () => {
                game.isPlaying = true;
                nextDirection();
            });
        }

        // å€’è®¡æ—¶
        function showCountdown(count, callback) {
            if (count === 0) {
                callback();
                return;
            }
            
            const countdownEl = document.createElement('div');
            countdownEl.id = 'countdown';
            countdownEl.textContent = count;
            gameScreen.appendChild(countdownEl);
            
            setTimeout(() => {
                countdownEl.remove();
                showCountdown(count - 1, callback);
            }, 1000);
        }

        // ç”Ÿæˆä¸‹ä¸€ä¸ªæ–¹å‘
        function nextDirection() {
            if (!game.isPlaying) return;
            
            game.currentDirection = game.directions[Math.floor(Math.random() * game.directions.length)];
            directionDisplay.textContent = game.currentDirection.symbol;
            directionDisplay.style.animation = 'none';
            setTimeout(() => {
                directionDisplay.style.animation = 'fadeInScale 0.3s';
            }, 10);
            
            // ç”Ÿæˆé£˜è½çš„å¿ƒå½¢
            createFallingHeart();
        }

        // æ›´æ–° HUD
        function updateHUD() {
            scoreEl.textContent = game.score;
            comboCountEl.textContent = game.combo;
            highScoreEl.textContent = game.highScore;
        }

        // è§¦æ‘¸/é¼ æ ‡äº‹ä»¶
        canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
        canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
        canvas.addEventListener('touchend', handleTouchEnd, { passive: false });
        canvas.addEventListener('mousedown', handleMouseDown);
        canvas.addEventListener('mousemove', handleMouseMove);
        canvas.addEventListener('mouseup', handleMouseUp);

        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;

        function handleTouchStart(e) {
            e.preventDefault();
            if (!game.isPlaying) return;
            const touch = e.touches[0];
            touchStart = { x: touch.clientX, y: touch.clientY };
            isDrawing = true;
            lastX = touch.clientX;
            lastY = touch.clientY;
        }

        function handleTouchMove(e) {
            e.preventDefault();
            if (!isDrawing || !game.isPlaying) return;
            const touch = e.touches[0];
            drawLine(lastX, lastY, touch.clientX, touch.clientY);
            lastX = touch.clientX;
            lastY = touch.clientY;
        }

        function handleTouchEnd(e) {
            e.preventDefault();
            if (!game.isPlaying || !touchStart) return;
            const touch = e.changedTouches[0];
            const touchEnd = { x: touch.clientX, y: touch.clientY };
            checkDirection(touchStart, touchEnd);
            touchStart = null;
            isDrawing = false;
            clearCanvas();
        }

        function handleMouseDown(e) {
            if (!game.isPlaying) return;
            touchStart = { x: e.clientX, y: e.clientY };
            isDrawing = true;
            lastX = e.clientX;
            lastY = e.clientY;
        }

        function handleMouseMove(e) {
            if (!isDrawing || !game.isPlaying) return;
            drawLine(lastX, lastY, e.clientX, e.clientY);
            lastX = e.clientX;
            lastY = e.clientY;
        }

        function handleMouseUp(e) {
            if (!game.isPlaying || !touchStart) return;
            const touchEnd = { x: e.clientX, y: e.clientY };
            checkDirection(touchStart, touchEnd);
            touchStart = null;
            isDrawing = false;
            clearCanvas();
        }

        // ç»˜åˆ¶çº¿æ¡
        function drawLine(x1, y1, x2, y2) {
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.lineWidth = 5;
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();
        }

        // æ¸…é™¤ç”»å¸ƒ
        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // æ£€æŸ¥æ–¹å‘
        function checkDirection(start, end) {
            const dx = end.x - start.x;
            const dy = end.y - start.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            // æœ€å°æ»‘åŠ¨è·ç¦»
            if (distance < 50) return;
            
            // è®¡ç®—è§’åº¦ (0åº¦ä¸ºå‘ä¸Š)
            let angle = Math.atan2(dy, dx) * 180 / Math.PI;
            angle = (angle + 90 + 360) % 360;
            
            // æ£€æŸ¥æ˜¯å¦åŒ¹é…
            const targetAngle = game.currentDirection.angle;
            const tolerance = 30; // å®¹å·®è§’åº¦
            
            let angleDiff = Math.abs(angle - targetAngle);
            if (angleDiff > 180) angleDiff = 360 - angleDiff;
            
            if (angleDiff <= tolerance) {
                onSuccess(end.x, end.y, angleDiff < 15);
            } else {
                onFail(end.x, end.y);
            }
        }

        // æˆåŠŸ
        function onSuccess(x, y, isPerfect) {
            game.combo++;
            game.maxCombo = Math.max(game.maxCombo, game.combo);
            
            // è®¡åˆ†ï¼šåŸºç¡€åˆ† + è¿å‡»åŠ æˆ
            const baseScore = isPerfect ? 100 : 50;
            const comboBonus = game.combo * 10;
            const earnedScore = baseScore + comboBonus;
            game.score += earnedScore;
            
            updateHUD();
            showFeedback(x, y, isPerfect ? 'PERFECT! +' + earnedScore : 'GOOD! +' + earnedScore, isPerfect ? 'perfect' : 'success');
            createParticles(x, y, isPerfect ? '#ffeb3b' : '#4caf50');
            
            // ä¸‹ä¸€ä¸ªæ–¹å‘
            setTimeout(() => nextDirection(), 300);
        }

        // å¤±è´¥
        function onFail(x, y) {
            game.isPlaying = false;
            showFeedback(x, y, 'MISS!', 'fail');
            createParticles(x, y, '#f44336');
            
            // æ›´æ–°æœ€é«˜åˆ†
            if (game.score > game.highScore) {
                game.highScore = game.score;
                localStorage.setItem('slashComboHighScore', game.highScore);
            }
            
            // æ˜¾ç¤ºæ¸¸æˆç»“æŸ
            setTimeout(() => {
                finalScoreEl.textContent = game.score;
                highScoreEl.textContent = game.highScore;
                gameOver.classList.add('show');
            }, 1000);
        }

        // æ˜¾ç¤ºåé¦ˆæ–‡å­—
        function showFeedback(x, y, text, type) {
            const feedback = document.createElement('div');
            feedback.className = `feedback ${type}`;
            feedback.textContent = text;
            feedback.style.left = x + 'px';
            feedback.style.top = y + 'px';
            document.body.appendChild(feedback);
            
            setTimeout(() => feedback.remove(), 1000);
        }

        // åˆ›å»ºç²’å­æ•ˆæœ
        function createParticles(x, y, color) {
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.background = color;
                particlesContainer.appendChild(particle);
                
                const angle = (Math.PI * 2 * i) / 20;
                const velocity = 3 + Math.random() * 5;
                const vx = Math.cos(angle) * velocity;
                const vy = Math.sin(angle) * velocity;
                
                animateParticle(particle, x, y, vx, vy);
            }
        }

        function animateParticle(particle, startX, startY, vx, vy) {
            let x = startX;
            let y = startY;
            let opacity = 1;
            let size = 20;
            
            function update() {
                x += vx;
                y += vy;
                opacity -= 0.02;
                size -= 0.4;
                
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.opacity = opacity;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                
                if (opacity > 0) {
                    requestAnimationFrame(update);
                } else {
                    particle.remove();
                }
            }
            
            update();
        }

        // åˆ›å»ºé£˜è½çš„å¿ƒå½¢
        function createFallingHeart() {
            const heart = document.createElement('div');
            heart.className = 'heart';
            heart.textContent = 'ğŸ’–';
            heart.style.left = Math.random() * window.innerWidth + 'px';
            heart.style.top = '-50px';
            gameScreen.appendChild(heart);
            
            setTimeout(() => heart.remove(), 3000);
        }

        // åˆå§‹åŒ–
        highScoreEl.textContent = game.highScore;

        // èƒŒæ™¯å¿ƒå½¢åŠ¨ç”»
        setInterval(() => {
            if (game.isPlaying) {
                createFallingHeart();
            }
        }, 2000);
    </script>
</body>
</html>
